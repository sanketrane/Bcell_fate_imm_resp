---
title: "Modelling MZB development during an active immune response"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, dev="cairo_pdf")


############################################################
### Preamble
############################################################

## loading libraries
library(tidyverse)
library(readxl)

#### plotting style
myTheme <- theme(text = element_text(size = 12), axis.text = element_text(size = 12),
                 axis.title =  element_text(size = 12, face = "bold"),
                 plot.title = element_text(size=12,  hjust = 0.5, face = "bold"),
                 legend.background = element_blank(), legend.key = element_blank())

# setting ggplot theme for rest fo the plots
theme_set(theme_bw())

fancy_scientific <- function(l) {
  # turn in to character string in scientific notation
  l <- format(l, scientific = TRUE)
  # quote the part before the exponent to keep all the digits
  l <- gsub("^(.*)e", "'\\1'e", l)
  # remove + after exponent, if exists. E.g.: (e^+2 -> e^2)
  l <- gsub("e\\+","e",l)  
  # turn the 'e' into plotmath format
  l <- gsub("e", "%*%10^", l)
  # convert 1x10^ or 1.000x10^ -> 10^
  l <- gsub("\\'1[\\.0]*\\'\\%\\*\\%", "", l)
  # return this as an expression
  parse(text=l)
}

log10minorbreaks = as.numeric(1:10 %o% 10^(-4:8))
```


### B cell fate determination upon TD immunization

We are intersted in understanding how and to what degree the cross-talk between antigen derived signals and environmental cues affect the fate decisions of B cells responding to an antigenic stimuli.
To address this, we study precursor-progeny relationships, cellular-flux and turnover of B cells in mice challenged with a T-dependent antigen (NP-CGG).

### Mouse model for fate-mapping of B cells responding to an antigen
To analyze B cells, which are activated by T-dependent (TD) immunization, we use C$\gamma1$-Cre driven CAR-reporter mice, in which B cells responding during an immune response permanently express CAR protein and thus can be tracked over time by antibody staining. 
Our preliminary analysis of B cell developmental dynamics in these mice revealed that a fraction of B cells that responded to the TD antigen (marked by CAR+ label) acquire MZ B cells phenotype and localize to the marginal zone in the spleen.
To investigate the factors determining the bifurcation of activated B cells (CAR+) into the MZ fate versus the GC driven plasma or memory fates, we track and model the kinetics of antigenically activated B cells within follicular (FO), GC and MZ B cell subsets in the CAR reporter mice post immunization and use it to build a quantitative map of B cell differentiation pathways during an immune response.


```{r include=FALSE, echo=FALSE}

## import data

## Immune response dynamics of B cells -- reporter induction upon b cell activation
NEW_CAR_prop_df <- read_excel("~/Dropbox/MZ_munich/Datafiles/NEW_CAR_fractions_TD_response.xlsx", sheet =1) %>%
  filter(genotype == "CAR") %>%
  select(-contains("counts"), -contains("PCs")) %>%
  gather(-c(days.post.imm, genotype), key = 'subpop', value='fraction_cells')



ggplot() +
  geom_point(data=NEW_CAR_prop_df, 
             aes(x= as.factor(days.post.imm), y=fraction_cells), col = 4) +
  scale_y_log10() + 
  labs(x='Days post immunization', y='% CAR+')+
  facet_wrap(.~ subpop) + myTheme + guides(col="none")
```
